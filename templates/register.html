<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Register</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">

    <style>
      :root{
        --bg: #f7f9ff;
        --bg2: #ffffff;
        --card: #ffffff;
        --card-border: #e9eef7;
        --text: #0f172a;
        --muted: #667085;
        --ring: #5184ff;

        --g1: #5ea0ff;
        --g2: #a37bff;
        --g3: #ff86b4;

        --field-bg: #f3f6ff;
        --field-border: #e2e8f0;
        --field-focus: rgba(81,132,255,.25);
        --placeholder: #8ea0c7;
      }

      *{ box-sizing: border-box; }
      html, body { margin: 0; }
      body{
        font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
        color: var(--text);
        background:
          radial-gradient(1200px 700px at 10% -10%, #e9f1ff 0%, transparent 50%),
          radial-gradient(1000px 600px at 100% 0%, #fde7f2 0%, transparent 55%),
          linear-gradient(180deg, var(--bg) 0%, var(--bg2) 100%);
        display:flex; align-items:center; justify-content:center;
        min-height: 100vh;                 /* allow scroll on small screens */
        padding: 24px;
        overflow-y: auto;                   /* <-- key fix */
      }

      /* On short viewports, pin to top so it never looks cut off */
      @media (max-height: 740px){
        body{ align-items: flex-start; }
        .card-bright{ margin-top: 24px; margin-bottom: 24px; }
      }
      @media (max-width: 480px){
        body{ padding: 16px; }
        .card-bright{ border-radius: 16px; }
      }

      .orb{
        position: fixed; filter: blur(60px); opacity:.6; pointer-events:none; z-index:0;
      }
      .orb.one{ width:420px; height:420px; top: -110px; left:-80px; background: radial-gradient(circle at 30% 30%, #b6d4ff, transparent 65%); }
      .orb.two{ width:460px; height:460px; bottom: -140px; right:-80px; background: radial-gradient(circle at 70% 70%, #ffd0e4, transparent 60%); }

      .card-bright{
        position:relative; z-index:1;
        width:100%; max-width: 500px;
        background: var(--card);
        border: 1px solid var(--card-border);
        border-radius: 20px;
        box-shadow: 0 20px 50px rgba(17, 24, 39, .08);
        overflow: hidden;
      }

      .header{
        padding: 28px 28px 8px;
        background:
          linear-gradient(180deg, rgba(255,255,255,.9), rgba(255,255,255,.7)),
          radial-gradient(400px 160px at 20% 0%, rgba(94,160,255,.18), transparent 60%),
          radial-gradient(400px 160px at 80% 0%, rgba(255,134,180,.18), transparent 60%);
      }

      .title{ font-weight:800; letter-spacing:.2px; font-size:1.55rem; margin:0; }
      .subtitle{ color:var(--muted); margin-top:6px; margin-bottom:0; font-size:.98rem; }

      .body{ padding: 20px 28px 24px; background:#fff; }

      .form-label{ font-weight:600; margin-bottom:8px; }

      .input-wrap{
        display:flex; align-items: stretch; gap: 8px;
        background: var(--field-bg);
        border:1px solid var(--field-border);
        border-radius:14px;
        padding: 10px 12px 10px 14px;
        transition: border-color .2s, box-shadow .2s, background .2s;
      }
      .input-wrap:focus-within{
        border-color: var(--ring);
        box-shadow: 0 0 0 4px var(--field-focus);
        background: #eef4ff;
      }
      .input-wrap input{
        background: transparent;
        color: var(--text);
        border: 0; outline: 0; width:100%;
        font-size: 1rem; padding: 4px 2px;
      }
      .input-wrap input::placeholder{ color: var(--placeholder); }

      .btn-mic, .btn-eye{
        border: 1px solid var(--field-border);
        background: #fff;
        color: var(--text);
        border-radius: 12px;
        padding: 8px 10px;
        transition: transform .08s ease, border-color .2s, background .2s, box-shadow .2s;
        box-shadow: 0 1px 0 rgba(17,24,39,.04);
      }
      .btn-mic:hover, .btn-eye:hover{
        background: #f9fbff; border-color: var(--ring);
        box-shadow: 0 6px 16px rgba(81,132,255,.18);
      }
      .btn-mic:active, .btn-eye:active{ transform: translateY(1px); }

      .btn-mic.listening{
        border-color:#ff6b81 !important;
        color:#ff3b57 !important;
        animation: pulse 1.1s infinite;
      }
      @keyframes pulse{
        0%{ box-shadow: 0 0 0 0 rgba(255,59,87,.18); }
        70%{ box-shadow: 0 0 0 12px rgba(255,59,87,0); }
        100%{ box-shadow: 0 0 0 0 rgba(255,59,87,0); }
      }

      .hint{ color:var(--muted); font-size:.9rem; margin-top:6px; }

      .btn-accent{
        width:100%;
        border:0; color:white; font-weight:700; letter-spacing:.2px;
        border-radius: 14px; padding: 12px 16px; margin-top: 6px;
        background: linear-gradient(135deg, var(--g1), var(--g2) 50%, var(--g3));
        box-shadow: 0 16px 32px rgba(81,132,255,.25), inset 0 0 0 1px rgba(255,255,255,.6);
        transition: filter .15s ease, transform .06s ease, box-shadow .2s ease;
      }
      .btn-accent:hover{ filter: brightness(1.05); box-shadow: 0 20px 40px rgba(81,132,255,.28), inset 0 0 0 1px rgba(255,255,255,.75); }
      .btn-accent:active{ transform: translateY(1px); }

      .footer{
        padding: 14px 28px 26px;
        border-top: 1px solid var(--card-border);
        color: var(--muted); font-size: .95rem; background:#fff;
      }
      .footer a{ color: #365cff; text-decoration: none; font-weight:600; }
      .footer a:hover{ text-decoration: underline; }

      .alert{
        border-radius: 12px; border:1px solid transparent; padding: 10px 12px;
        font-size: .95rem; margin-bottom: 12px;
      }
      .alert-success{ color:#0b9d79; background: rgba(11,157,121,.08); border-color: rgba(11,157,121,.25); }
      .alert-danger{ color:#b61d3d; background: rgba(255,59,87,.08); border-color: rgba(255,59,87,.25); }
      .alert-warning{ color:#9a6b00; background: rgba(255,193,7,.12); border-color: rgba(255,193,7,.28); }
      .alert-info{ color:#2656c9; background: rgba(94,160,255,.14); border-color: rgba(94,160,255,.28); }

      .btn-mic:focus-visible, .btn-eye:focus-visible, .btn-accent:focus-visible{
        outline: none; box-shadow: 0 0 0 4px var(--field-focus);
      }
    </style>
  </head>
  <body>
    <div class="orb one"></div>
    <div class="orb two"></div>

    <div class="card-bright">
      <div class="header text-center">
        <h1 class="title">Create your account</h1>
        <p class="subtitle">Join to access your workspace</p>
      </div>

      <div class="body">
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for cat, msg in messages %}
              <div class="alert alert-{{cat}}">{{ msg }}</div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <form method="post" id="registerForm" novalidate>
          <div class="mb-3">
            <label class="form-label" for="username">Username</label>
            <div class="input-wrap">
              <input id="username" type="text" name="username" placeholder="yourname" required data-speech="true" autocomplete="username" />
              <button type="button" class="btn-mic" aria-label="Dictate Username" title="Dictate">ğŸ¤</button>
            </div>
            <div class="hint">Pick a unique handle youâ€™ll remember.</div>
          </div>

          <div class="mb-3">
            <label class="form-label" for="email">Email</label>
            <div class="input-wrap">
              <input id="email" type="email" name="email" placeholder="you@example.com" required data-speech="true" autocomplete="email" />
              <button type="button" class="btn-mic" aria-label="Dictate Email" title="Dictate">ğŸ¤</button>
            </div>
            <div class="hint">Use a valid email for account recovery.</div>
          </div>

          <div class="mb-3">
            <label class="form-label" for="password">Password</label>
            <div class="input-wrap">
              <input id="password" type="password" name="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required minlength="6" data-speech="true" autocomplete="new-password" />
              <button type="button" class="btn-mic" aria-label="Dictate Password" title="Dictate">ğŸ¤</button>
              <button type="button" class="btn-eye" id="togglePwd" aria-label="Show/Hide Password" title="Show/Hide">ğŸ‘ï¸</button>
            </div>
            <div class="hint">Use at least 6 characters. Add numbers and symbols for strength.</div>
          </div>

          <div class="mb-2">
            <label class="form-label" for="confirm">Confirm Password</label>
            <div class="input-wrap">
              <input id="confirm" type="password" name="confirm" placeholder="Repeat password" required minlength="6" data-speech="true" autocomplete="new-password" />
              <button type="button" class="btn-mic" aria-label="Dictate Confirm Password" title="Dictate">ğŸ¤</button>
              <button type="button" class="btn-eye" id="toggleConfirm" aria-label="Show/Hide Confirm" title="Show/Hide">ğŸ‘ï¸</button>
            </div>
            <div class="hint">Make sure both passwords match exactly.</div>
          </div>

          <button type="submit" class="btn-accent">Create account</button>
        </form>
      </div>

      <div class="footer text-center">
        Already registered? <a href="{{ url_for('login') }}">Login here</a>
        <div id="srStatus" class="small mt-2"></div>
      </div>
    </div>

    <script>
      // Show/Hide password fields
      document.getElementById('togglePwd')?.addEventListener('click', () => {
        const el = document.getElementById('password');
        el.type = (el.type === 'password') ? 'text' : 'password';
      });
      document.getElementById('toggleConfirm')?.addEventListener('click', () => {
        const el = document.getElementById('confirm');
        el.type = (el.type === 'password') ? 'text' : 'password';
      });

      // --- Web Speech API wiring for all inputs with data-speech="true" ---
      (function () {
        const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
        const statusEl = document.getElementById('srStatus');

        if (!SR) {
          if (statusEl) statusEl.textContent = 'Speech recognition not supported in this browser.';
          document.querySelectorAll('.btn-mic').forEach(btn => {
            btn.disabled = true;
            btn.title = 'Speech recognition not supported in this browser.';
          });
          return;
        }

        let recognition = null;
        let activeBtn = null;
        let activeInput = null;

        function startRecognition(forInput, btn) {
          stopRecognition();

          recognition = new SR();
          recognition.lang = navigator.language || 'en-US';
          recognition.interimResults = false;
          recognition.maxAlternatives = 1;
          activeBtn = btn;
          activeInput = forInput;

          btn.classList.add('listening');
          if (statusEl) statusEl.textContent = 'Listeningâ€¦';

          recognition.onresult = (event) => {
            const transcript = (event.results[0]?.[0]?.transcript) || '';
            activeInput.value = transcript;
          };

          recognition.onerror = (e) => {
            if (statusEl) statusEl.textContent = 'Speech error: ' + (e.error || 'unknown');
          };

          recognition.onend = () => {
            btn.classList.remove('listening');
            if (statusEl) statusEl.textContent = '';
            recognition = null;
            activeBtn = null;
            activeInput = null;
          };

          try { recognition.start(); } catch (_) {}
        }

        function stopRecognition() {
          if (recognition) {
            try { recognition.stop(); } catch (_) {}
            recognition = null;
          }
          if (activeBtn) activeBtn.classList.remove('listening');
          if (statusEl) statusEl.textContent = '';
        }

        document.querySelectorAll('input[data-speech="true"]').forEach((input) => {
          const wrap = input.closest('.input-wrap');
          const micBtn = wrap?.querySelector('.btn-mic');
          if (!micBtn) return;

          micBtn.addEventListener('click', () => {
            if (micBtn.classList.contains('listening')) stopRecognition();
            else startRecognition(input, micBtn);
          });

          input.addEventListener('keydown', (e) => { if (e.key === 'Escape') stopRecognition(); });
        });

        document.getElementById('registerForm')?.addEventListener('submit', () => stopRecognition());
      })();
    </script>
  </body>
</html>
